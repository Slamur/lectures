# Эффективность алгоритма

Представим ситуацию: вы прочли задачу и быстро придумали к ней простой алгоритм решения. Реализовали его на любимом ЯП, после чего отправили в тестирующую систему.

И получили вердикт "Превышено ограничение времени"...

Чаще всего это связано с недостаточной **эффективностью** вашего алгоритма.

Но как вы должны были это понять?! Как вы могли до написания и отправки кода в систему понять, что ваше решение выйдет за ограничения по времени?

**Ответ**: оценить количество простых операций.

## Простые операции и скорость их выполнения

Одной из важных характеристик компьютера является **тактовая частота** процессора (измеряется в герцах).

Эта величина показывает, сколько "тактов" успевает обработать процессор за одну секунду.

По сути такты - это единицы дискретного времени для процессора.

Современные процессоры выполняют **миллиарды тактов** в секунду (то есть их тактовая частота измеряется уже в **гига**герцах).

### Одна операция - несколько тактов

Такт является элементарной единицей выполнения, за которую выполняются базовые машинные операции.

Но одна операция в вашем ЯП не всегда совпадает с одной машинной операцией.

Поэтому часто используется оценка в $10^8$ операций за секунду. Обратите внимание, что это не четкое ограничение - это по сути порядок величин, на который можно ориентироваться.

**Важно**: у всех ЯП различная производительность. Например, для Python рекомендуется в большинстве случаев ориентироваться на порядок $10^7$ операций. 

### Зачем об этом думать?

Если для вашего алгоритма существует тест с наибольшим числом операций - авторы задачи постараются его добавить в набор. 

Соответственно дальнейшие рассуждения будут производиться относительно **худшего случая** для вашего алгоритма.

В идеале порядок количества операций должен быть меньше максимального на 1-2 - тогда вам не придется думать о более точной оценке, и так будет понятно, что работает быстро. 

С другой стороны, что если программа выполняет порядка $10^{12}$ операций, то в секунду она не уложится никак, да и в 2 секунды тоже.

## Асимптотика - оценка эффективности

Допустим, что у нас есть алгоритм, зависящий от одного целого числа $N$.

Обозначим через $T(N)$ функцию, вычисляющую количество операций нашего алгоритма для заданного $N$.

В большинстве случаев вычислять или определять конкретное значение $T(N)$ является затратным и не особо полезным.

Поэтому в программировании стараются использовать **оценку** количества операций - ведь зачастую вам важен лишь порядок, а не точное число.

### "О большое"

Введём **обозначение**: для какой-либо функции $F(N)$ будем говорить, что $T(N) = O(F(N))$,

если существуют такие константы $C > 0$ и $N_0 \ge 0$, что $T(N) \le C \cdot F(N)$ для всех $N \ge N_0$.

По сути “О большое” является обозначением **оценки сверху** для функции $T(N)$ через функцию $F(N)$ при стремлении $N$ к **бесконечности**.

#### Примеры

Пусть $T(N) = 3 \cdot N^2 + 20$.

В таком случае

##### Пример 1

При $F(N) = N^2$ **верно**, что $T(N) = O(F(N))$.

Доказательство:

<details> <summary> </summary>

- Пусть $C = 4$.
- Рассмотрим неравенство $(3 \cdot N^2 + 20) \le 4 \cdot N^2$.
- Из него следует, что $N^2 - 20 \ge 0$.
- Решением неравенства в целых положительных числах является $N \ge 5$. 
- Соответственно, для заданного $C = 4$ существует $N_0 = 5$, что для всех $N \ge N_0$ неравенство выполняется.

По сути это означает, что начиная с $N \ge 5$ выражение $4 \cdot N^2$ будет оценкой сверху для $(3 \cdot N^2 + 20)$.

</details>

##### Пример 2

При $F(N) = N^3$ **верно**, что $T(N) = O(F(N))$.

Доказательство:

<details> <summary> </summary>

- Пусть $C = 2$.
- Рассмотрим неравенство $(3 \cdot N^2 + 20) \le 2 \cdot N^3$.
- Можно показать, что в целых положительных числах данное неравенство имеет решение $N \ge 3$.
- Например, $3 \cdot 4^2 + 20 = 68$, а $2 \cdot 4^3 = 128$.
- Соответственно, для заданного $C = 2$ существует $N_0 = 3$, что для всех $N \ge N_0$ неравенство выполняется.

По сути это означает, что начиная с $N \ge 3$ выражение $2 \cdot N^3$ будет оценкой сверху для $(3 \cdot N^2 + 20)$.

</details>

##### Пример 3

При $F(N) = N$ **не верно**, что $T(N) = O(F(N))$.

Доказательство:

<details> <summary> </summary>

- Рассмотрим неравенство $(3 \cdot N^2 + 20) \le C \cdot N$.
- Из этого следует, что $3 \cdot N^2 - C \cdot N + 20 \le 0$.
- Так как неравенство квадратное, то вычислим дискриминант $D = C^2 - 4 \cdot 3 \cdot 20$.
- Целые положительные решения этого неравенства будут удовлетворять неравенству $N \le \frac{C - \sqrt{D}}{6}$.
- Видно, что для любой выбранной константы $C$ будет существовать ограничение сверху для $N$, после которой неравенство перестаёт выполняться.

По сути это означает, что ни для какого $C$ функция $C \cdot N$ не может быть оценкой сверху на достаточно больших $N$ для $(3 \cdot N^2 + 20)$.

</details>

#### А если у алгоритма несколько параметров?

В общем случае можно считать, что "О большое" должно работать для каждого параметра независимо (или для какой-либо их комбинации).

Соответственно, в дальнейшем под $N$ будет пониматься любой набор числовых параметров алгоритма $N_1, N_2, \dots, N_k$.

#### Другие обозначения

Аналогично "О большому" существуют обозначения для других видов оценки - [таблица в статье](https://ru.wikipedia.org/wiki/«O»_большое_и_«o»_малое) Википедии.

### Определение асимптотики

Будем называть функцию $F(N)$ **асимптотикой** алгоритма с количеством операций $T(N)$, если 

- $T(N) = O(F(N))$, 
- $F(N) = O(T(N))$ (иногда нет, но это очень узкие случаи), 
- $F(N)$ содержит лишь **несравнимые** слагаемые.
- Коэффициенты при слагаемых равны $1$.
- $F(N)$ не содержит слагаемых и множителей, не зависящих от параметров алгоритма (если у вас такие есть, то сделайте их параметрами).

**Определение**: Слагаемые $X(N)$ и $Y(N)$ назовём **несравнимыми**, если 

- $X(N) \ne O(Y(N))$
- $Y(N) \ne O(X(N))$

#### А можно попроще?

По сути **асимптотика** говорит о поведении функции $T(N)$ при стремлении параметров к граничным (бесконечным) значениям.

Для оценки выбирается функция $F(N)$, изменяющаяся **аналогичным образом** при росте $N$.

Так как нас интересуют граничные значения, то в функции $F$ оставляют только **важные для оценки** слагаемые.

Коэффициенты при слагаемых берутся равными $1$, так как по определению "О большого" $F(N)$ всё равно **умножается на константу**.

#### Примеры

##### Пример 1

$F(N) = N^2$ **является** асимптотикой для $T(N) = 3 \cdot N^2 + 20$.

Доказательство:

<details> <summary> </summary>

- $T(N) = O(F(N))$ - см. пример 1 к определению "О большого".
- $F(N) = O(T(N))$ - существуют $C = 1$ и $N_0 = 1$ такие, что $N^2 \le 1 \cdot (3 \cdot N^2 + 2)$ для $N \ge 1$.
- Коэффициент при слагаемом $N^2$ равен $1$.

По сути, это означает, что функцию $F(N)$ удобно использовать для оценки поведения функции $T(N)$ на больших $N$.

Например, при увеличении $N$ в $10$ раз обе функции $F(N)$ и $T(N)$ вырастут примерно в $100$ раз.
  
</details>

##### Пример 2

$F(N, M) = N^2 + M \cdot N + M^3$ **является** асимптотикой для $T(N, M) = N^2 + 3 \cdot M \cdot N + \frac{M^3}{10} + 100 \cdot M^2 + 20$

Доказательство:

<details> <summary> </summary>

- $T(N, M) = O(F(N, M))$ - существуют $C = 3$, $N_0 = 1$ и $M_0 = 100$ такие, что

  $N^2 + 3 \cdot M \cdot N + \frac{M^3}{10} + 100 \cdot M^2 + 20 \le 4 \cdot (N^2 + M \cdot N + M^3)$ для $N \ge 1$ и $M \ge 100$.
  
- $F(N, M) = O(T(N, M))$ - cуществуют $C = 10$, $N_0 = 1$, $M_0 = 1$ такие, что

  $N^2 + M \cdot N + M^3 \le 10 \cdot (N^2 + 3 \cdot M \cdot N + \frac{M^3}{10} + 100 \cdot M^2 + 20)$ для $N \ge 1$ и $M \ge 1$.
  
- Коэффициенты при слагаемых $N^2$, $M \dot N$, $M^3$ равны $1$; 
- $M^3$ сравнимо с $M^2$, поэтому $M^2$ не включено в $F(N, M)$.
- $20$ не зависит от параметров, поэтому $20$ не включено в $F(N, M)$.

**Примечание**

Можно заметить, что 

- если $M \le N$, то $M \cdot N \le N^2$;
- если $N \le M$, то $M \cdot N \le M^3$.

Из чего можно сделать вывод, что на самом деле $F(N, M) = N^2 + M^3$. 

Да, такая оценка возможна, но в большинстве случаев вам будет достаточно простого способа анализа, приведенного в примере.

</details>

##### Пример 3

$F(N) = N^3$ **не является** асимптотикой для $T(N) = 3 \cdot N^2 + 20$.

Доказательство:

<details> <summary> </summary>

Да, $T(N) = O(F(N))$ - см. пример 2 из определения "О большого".

То есть "оценкой сверху" функция $F(N)$ является.

Но асимптотика должна вести себя аналогично оригинальной функции.

В данном же случае $F(N) \ne O(T(N))$: для всех $C \ge 0$ неравенство $N^3 \le C \cdot (3 \cdot N^2 + 2)$ выполняется только для $N \le 3 \cdot C$.

Получается, что на больших $N$ функция $F(N)$ растёт куда быстрее $T(N)$, поэтому оценки с ней будут слишком **пессимистичными** для анализа.

</details>

##### Пример 4

$F(N) = N$ **не является** асимптотикой для $T(N) = 3 \cdot N^2 + 20$.

Доказательство:

<details> <summary> </summary>

Как мы помним,  $T(N) \ne O(F(N))$ - см. пример 3 из определения "О большого".

Соответственно $F(N)$ не годится в роли "оценки сверху" при достаточно больших $N$.

Получается, что оценки через $F(N)$ будут слишком **оптимистичными** для анализа.

</details>

##### Пример 5

$F(N) = N^2 + N$ **не является** асимптотикой для $T(N)$.

**Доказательство**

<details> <summary> </summary>
	
Слагаемые $N^2$ и $N$ сравнимы между собой, так как $N = O(N^2)$.

Для простоты описания в асимптотике оставляют только **важные для оценки** слагаемые - в данном случае это $N^2$.

При проверке на "О большое" для функций $N^2$ и $N^2 + N$ будет отличаться лишь константа $C$ (но не факт её наличия).

</details>

##### Пример 6

$F(N) = 2 \cdot N^2$ **не является** асимптотикой для $T(N)$.

Доказательство:

<details> <summary> </summary>
	
Коэффициент при слагаемом $N^2$ равен $2 \ne 1$.

Для простоты описания в качестве асимптотик используют функции без лишних коэффициентов - в данном случае это $N^2$.

При проверке на "О большое" для функций $N^2$ и $2 \cdot N^2$ будет отличаться лишь константа $C$ (но не факт её наличия).

</details>

### Зачем нужна асимптотика?

В качестве асимптотики $F(N)$ зачастую берутся простые для вычисления функции.

Соответственно, подставляя в данную функцию значения параметров алгоритма $N$, вы можете **оценить** ожидаемое количество операций без сложных вычислений и анализа.

Оценка позволит вам понять, насколько вероятно ваше решение пройдет заданные ограничения по времени и памяти (зачастую или "точно пройдет", или "точно не пройдет").
