# Хэш-функция

## "Неудобные" ключи

Ранее мы обсуждали одну из возможных реализаций словаря, основанную на массиве.

Главным минус такого словаря - ключи обязаны быть целыми числа в промежутке $[0; K]$, причем объем используемой памяти равен $O(K)$.

Как вы понимаете, в реальной жизни далеко не всегда ключи бывают настолько "удобными":

- целые числа порядка $10^9$ или даже $10^18$;
- вещественные числа;
- строки и другие последовательности;
- объекты пользовательских классов.

## Переход к целому числу

Допустим, в решаемой вами задачи есть $N$ различных ключей.

В таком случае **теоретически** каждому ключу можно сопоставить **уникальное** целое число в промежутке $[0; N - 1]$.

По сути речь идёт о **биекции** между оригинальными ключами и целыми числами.

Если такая биекция возможна - то проблема решается использование "словаря на массиве", с которым вы уже познакомились ранее.

## Хеширование

Основная проблема построения биекции в том, что эффективное вычисление соответствующего ключу целого числа не всегда возможно.

Зачастую все возможные ключи даже не известны заранее, поэтому переход к целому числу должен зависеть **только от самого ключа**.

По сути мы получаем **функциональную зависимость** $H(K)$, где

- $K$ - искомый ключ;
- $H$ - функция вычисления соответствующего целого числа.

Этот процесс называется **хешированием**, а функция $H$ - хеш-функцией.

Важно понимать, что не любая функция может использоваться для хеширования. Любая хеш-функция должна удовлетворять двум взаимосвязанным критериям:

- если $K1 = K2$, то $H(K1) = H(K2)$;
- если $H(K1) \ne H(K2)$, то $K1 \ne K2$.

### Коллизии хешей

Может показаться, что это аналогично отношению биекции, но это не так.

Критерии хеш-функции не запрещают ситуацию, когда $H(K1) = H(K2)$, но $K1 \ne K2$.

Такая ситуация называется **коллизией**.

Частота и условия возникновения коллизий являются одним из основных критериев при правильном выборе хеш-функций.

#### Коллизия - это ошибка?

Важно понимать, что коллизия не является чем-то "неправильным" или какой-то "недоработкой".

Существуют ситуации, когда искомое множество ключей принципиально больше по размеру, чем итоговый целочисленный результат может вместить.

Либо построение чисто биективной функции является настолько неэффективным, что проще заранее заложить риски коллизий и ресурсы на её обработку.

Коллизии являются неотъемлемой частью подавляющего большинства используемых хеш-функций, их надо учитываять при выборе хеш-функции.

В то же время коллизии в большинстве хеш-функций **сложно воспроизводимы**, поэтому в большинстве задач они считаются маловероятными (а значит и решение проблем, связанных с ними, не требует множества ресурсов).